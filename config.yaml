name: "CatFlap"
version: "0.9.7-alpha"
slug: "catflap"
description: >-
  Replay Flipper Zero .sub (RAW), .rfcat.json, and optional .py scripts as Home Assistant MQTT buttons,
  transmitting via an RFCat-compatible CC1111 dongle (Yard Stick One, etc.).
url: "https://github.com/jaronmcd/CatFlap"

arch:
  - aarch64
  - amd64
  - armv7

startup: application
boot: auto
init: false

map:
  - share:rw

usb: true
udev: true

options:
  mqtt_broker: "core-mosquitto"
  mqtt_port: 1883
  mqtt_user: ""
  mqtt_password: ""

  node_id: "catflap"
  sub_directory: "/share/tx_files"

  # Optional: allow running user-provided Python scripts (*.py) from sub_directory.
  # WARNING: scripts run with the add-on's permissions.
  allow_python_scripts: false
  python_timeout_s: 30

  # -----------------------------
  # TX power (simple / recommended)
  # -----------------------------
  # smart   = uses TI table (freq -> band) + (target dBm -> PATABLE code)
  # max     = rfcat/rflib helper
  # default = don't touch power registers
  # manual  = advanced (FREND0 + PATABLE below)
  tx_power_mode: "smart"

  # Human-friendly table target (dropdown)
  tx_power_target_dbm: 0

  # auto = infer from replay file TX frequency
  # or force bucket:
  tx_power_band: "auto"

  # -----------------------------
  # Advanced / manual (ignored unless tx_power_mode == "manual")
  # -----------------------------
  # IMPORTANT: give a real default so HA doesn't block startup
  frend0_pa_power: 1
  frend0_lodiv_buf_current_tx: 0
  patable: ""

schema:
  mqtt_broker: str
  mqtt_port: port
  mqtt_user: str?
  mqtt_password: password?

  node_id: str
  sub_directory: str

  allow_python_scripts: bool?
  python_timeout_s: int?

  # Dropdowns (much more intuitive)
  tx_power_mode: list(smart|max|default|manual)
  tx_power_target_dbm: list(-30|-20|-15|-10|-5|0|5|7|10)
  tx_power_band: list(auto|315|433|868|915)

  # Advanced/manual (optional to the user, but we provide defaults above)
  frend0_pa_power: int
  frend0_lodiv_buf_current_tx: int
  patable: str?
